<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Academia</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        
        .header {
            background: linear-gradient(135deg, #1e3a8a, #7c3aed);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 1.5rem;
        }
        
        .logout-btn {
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .logout-btn:hover {
            background: rgba(255,255,255,0.3);
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-card h3 {
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: #7c3aed;
        }
        
        .sections {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .section {
            background: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .section h2 {
            color: #333;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #7c3aed;
        }
        
        .data-list {
            list-style: none;
        }
        
        .data-item {
            padding: 0.75rem;
            margin-bottom: 0.5rem;
            background: #f8f9fa;
            border-radius: 5px;
            border-left: 4px solid #7c3aed;
        }
        
        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }
        
        .error {
            background: #ffe6e6;
            color: #d8000c;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            border-left: 4px solid #d8000c;
        }
        
        .success {
            background: #e6ffe6;
            color: #4f8a10;
            padding: 1rem;
            border-radius: 5px;
            margin-bottom: 1rem;
            border-left: 4px solid #4f8a10;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üèãÔ∏è‚Äç‚ôÇÔ∏è Dashboard - Academia</h1>
        <button class="logout-btn" onclick="handleLogout()">Sair</button>
    </div>

    <div class="container">
        <div id="message-area"></div>
        
        <!-- Stats Cards -->
        <div class="stats-grid">
            <div class="stat-card">
                <h3>Total de Alunos</h3>
                <div class="stat-number" id="total-alunos">-</div>
            </div>
            <div class="stat-card">
                <h3>Total de Professores</h3>
                <div class="stat-number" id="total-professores">-</div>
            </div>
            <div class="stat-card">
                <h3>Total de Treinos</h3>
                <div class="stat-number" id="total-treinos">-</div>
            </div>
            <div class="stat-card">
                <h3>Total de Planos</h3>
                <div class="stat-number" id="total-planos">-</div>
            </div>
        </div>

        <!-- Data Sections -->
        <div class="sections">
            <div class="section">
                <h2>üë• Alunos</h2>
                <ul class="data-list" id="alunos-list">
                    <li class="loading">Carregando...</li>
                </ul>
            </div>
            
            <div class="section">
                <h2>üë®‚Äçüè´ Professores</h2>
                <ul class="data-list" id="professores-list">
                    <li class="loading">Carregando...</li>
                </ul>
            </div>
            
            <div class="section">
                <h2>üèãÔ∏è‚Äç‚ôÇÔ∏è Treinos</h2>
                <ul class="data-list" id="treinos-list">
                    <li class="loading">Carregando...</li>
                </ul>
            </div>
            
            <div class="section">
                <h2>üí≥ Planos</h2>
                <ul class="data-list" id="planos-list">
                    <li class="loading">Carregando...</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Verificar se est√° logado
        if (!localStorage.getItem('userToken')) {
            window.location.href = 'login-simple.html';
        }

        // Fun√ß√£o de logout
        function handleLogout() {
            if (confirm('Tem certeza que deseja sair?')) {
                localStorage.clear();
                window.location.href = 'login-simple.html';
            }
        }

        // Fun√ß√£o para mostrar mensagens
        function showMessage(message, type = 'error') {
            const messageArea = document.getElementById('message-area');
            messageArea.innerHTML = `<div class="${type}">${message}</div>`;
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 5000);
        }

        // Fun√ß√£o para fazer requisi√ß√µes √† API
        async function fetchData(endpoint) {
            try {
                const token = localStorage.getItem('userToken');
                const response = await fetch(`http://localhost:3000/${endpoint}`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (!response.ok) {
                    if (response.status === 401) {
                        throw new Error('Sess√£o expirada. Fa√ßa login novamente.');
                    }
                    throw new Error(`Erro ao carregar ${endpoint}`);
                }

                return await response.json();
            } catch (error) {
                console.error(`Erro ao carregar ${endpoint}:`, error);
                if (error.message.includes('Sess√£o expirada')) {
                    localStorage.clear();
                    window.location.href = 'login-simple.html';
                }
                throw error;
            }
        }

        // Fun√ß√£o para renderizar dados
        function renderData(containerId, data, fields) {
            const container = document.getElementById(containerId);
            
            if (!data || data.length === 0) {
                container.innerHTML = '<li class="loading">Nenhum registro encontrado</li>';
                return;
            }

            container.innerHTML = data.map(item => {
                const info = fields.map(field => `${field}: ${item[field] || 'N/A'}`).join(' | ');
                return `<li class="data-item">${info}</li>`;
            }).join('');
        }

        // Carregar todos os dados
        async function loadAllData() {
            try {
                console.log('Carregando dados...');
                
                // Carregar alunos
                try {
                    const alunos = await fetchData('alunos');
                    document.getElementById('total-alunos').textContent = alunos.length;
                    renderData('alunos-list', alunos, ['nome', 'email', 'idade']);
                } catch (error) {
                    document.getElementById('alunos-list').innerHTML = '<li class="loading">Erro ao carregar</li>';
                }

                // Carregar professores
                try {
                    const professores = await fetchData('professores');
                    document.getElementById('total-professores').textContent = professores.length;
                    renderData('professores-list', professores, ['nome', 'email', 'especialidade']);
                } catch (error) {
                    document.getElementById('professores-list').innerHTML = '<li class="loading">Erro ao carregar</li>';
                }

                // Carregar treinos
                try {
                    const treinos = await fetchData('treinos');
                    document.getElementById('total-treinos').textContent = treinos.length;
                    renderData('treinos-list', treinos, ['nome', 'tipo', 'duracao']);
                } catch (error) {
                    document.getElementById('treinos-list').innerHTML = '<li class="loading">Erro ao carregar</li>';
                }

                // Carregar planos
                try {
                    const planos = await fetchData('planos');
                    document.getElementById('total-planos').textContent = planos.length;
                    renderData('planos-list', planos, ['nome', 'tipo', 'preco']);
                } catch (error) {
                    document.getElementById('planos-list').innerHTML = '<li class="loading">Erro ao carregar</li>';
                }

                showMessage('Dados carregados com sucesso!', 'success');
                
            } catch (error) {
                console.error('Erro geral ao carregar dados:', error);
                showMessage(`Erro ao carregar dados: ${error.message}`);
            }
        }

        // Inicializar quando a p√°gina carregar
        document.addEventListener('DOMContentLoaded', () => {
            loadAllData();
        });
    </script>
</body>
</html>
